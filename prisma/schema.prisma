generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//Models

enum TypeInvestment {
  ACAO
  BDR
  CDB
  COE
  FIIS
  LCI
  LCA
  LC
  MULTIMERCADO
  TESOURODIRETO
  OPCOES
}

model Country {
  id         Int          @id @default(autoincrement())
  name       String       @db.VarChar(300)
  Investment Investment[]

  @@map("countries")
}

model User {
  id        Int     @id @default(autoincrement())
  name      String  @db.VarChar(300)
  email     String  @unique @db.VarChar(500)
  cpf       String  @unique @db.VarChar(20)
  avatarUrl String? @db.VarChar()

  Investment Investment[]

  @@index([email])
  @@map("users")
}

model Asset {
  id      Int     @id @default(autoincrement())
  name    String  @db.VarChar(20)
  code    String  @unique @db.VarChar(10)
  iconUrl String? @db.VarChar()

  PurchasedAsset PurchasedAsset[]

  @@index([code])
  @@map("assets")
}

model PurchasedAsset {
  id            Int      @id @default(autoincrement())
  price         Decimal  @default(0)
  quantity      Float    @default(0)
  total         Decimal  @default(0)
  totalWithFees Decimal  @default(0)
  date          DateTime
  month         Int
  year          Int

  assetId      Int
  Asset        Asset       @relation(fields: [assetId], references: [id])
  investmentId Int?
  Investment   Investment? @relation(fields: [investmentId], references: [id])


  @@map("purchasedAssets")
}

model Investment {
  id        Int            @id @default(autoincrement())
  total     Decimal        @default(0)
  totalFees Decimal        @default(0)
  type      TypeInvestment

  country         Country          @relation(fields: [countryId], references: [id])
  countryId       Int
  user            User?            @relation(fields: [userId], references: [id])
  userId          Int?
  PurchasedAssets PurchasedAsset[]

  @@index([userId])
  @@map("investments")
}
