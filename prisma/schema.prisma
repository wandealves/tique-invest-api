generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//Models

enum TypeAsset {
  ACAO
  BDR
  CDB
  COE
  FIIS
  LCI
  LCA
  LC
  MULTIMERCADO
  TESOURODIRETO
  OPCOES
}

model Country {
  id         Int          @id @default(autoincrement())
  name       String       @db.VarChar(300)
  Investment Investment[]

  @@map("countries")
}

model User {
  id        Int     @id @default(autoincrement())
  name      String  @db.VarChar(300)
  email     String  @unique @db.VarChar(500)
  avatarUrl String? @db.VarChar()

  Investment     Investment[]
  PurchasedAsset PurchasedAsset[]

  @@index([email])
  @@map("users")
}

model Asset {
  id      Int     @id @default(autoincrement())
  name    String  @db.VarChar(20)
  code    String  @unique @db.VarChar(10)
  iconUrl String? @db.VarChar()

  type            TypeAsset
  PurchasedAssets PurchasedAsset[]

  @@index([code])
  @@map("assets")
}

model PurchasedAsset {
  id       Int     @id @default(autoincrement())
  price    Decimal @default(0)
  quantity Float   @default(0)

  asset        Asset       @relation(fields: [assetId], references: [id])
  assetId      Int
  Investment   Investment? @relation(fields: [investmentId], references: [id])
  investmentId Int?
  user         User        @relation(fields: [userId], references: [id])
  userId       Int

  @@index([assetId, userId])
  @@map("purchased-assets")
}

model Investment {
  id    Int     @id @default(autoincrement())
  total Decimal @default(0)

  country         Country          @relation(fields: [countryId], references: [id])
  countryId       Int
  user            User?            @relation(fields: [userId], references: [id])
  userId          Int?
  PurchasedAssets PurchasedAsset[]

  @@index([userId])
  @@map("investments")
}
