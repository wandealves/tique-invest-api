generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//Models

enum TypeTicket {
  ACAO
  BDR
  CDB
  COE
  FIIS
  LCI
  LCA
  LC
  MULTIMERCADO
  TESOURODIRETO
  OPCOES
}

enum CurrencyCode {
  BRL
  EUR
  USD
}

enum TransactionType {
  COMPRA
  VENDA
}

model Country {
  id   Int    @id @default(autoincrement())
  name String @db.VarChar(300)

  @@map("countries")
}

model User {
  id        Int     @id @default(autoincrement())
  name      String  @db.VarChar(300)
  email     String  @unique @db.VarChar(500)
  cpf       String  @unique @db.VarChar(20)
  avatarUrl String? @db.VarChar()

  Wallet Wallet[]

  @@index([email])
  @@map("users")
}

model Ticket {
  id      Int        @id @default(autoincrement())
  name    String     @db.VarChar(500)
  code    String     @unique @db.VarChar(10)
  iconUrl String?    @db.VarChar()
  type    TypeTicket

  ticketPurchased TicketPurchased[]

  WalletTicket WalletTicket[]
  @@index([code])
  @@map("tickets")
}

model TicketPurchased {
  id                      Int             @id @default(autoincrement())
  price                   Decimal         @default(0)
  quantity                Float           @default(0)
  total                   Decimal         @default(0)
  totalWithFees           Decimal         @default(0)
  apportionmentValue      Decimal         @default(0)
  apportionmentPercentage Float           @default(0)
  date                    DateTime
  month                   Int
  year                    Int
  brokerName              String          @db.VarChar(200)
  transactionType         TransactionType
  currencyCode            CurrencyCode

  ticketId Int
  ticket   Ticket  @relation(fields: [ticketId], references: [id])
  walletId Int?
  wallet   Wallet? @relation(fields: [walletId], references: [id])

  @@map("ticketsPurchased")
}

model WalletTicket {
  id              Int             @id @default(autoincrement())
  averagePrice    Decimal         @default(0)
  quantity        Float           @default(0)
  total           Float           @default(0)
  brokerName      String          @db.VarChar(200)
  transactionType TransactionType
  currencyCode    CurrencyCode

  ticketId Int
  ticket   Ticket @relation(fields: [ticketId], references: [id])

  walletId Int?
  Wallet   Wallet? @relation(fields: [walletId], references: [id])

  @@map("walletTickets")
}

model Wallet {
  id           Int          @id @default(autoincrement())
  name         String       @db.VarChar(150)
  total        Decimal      @default(0)
  totalFees    Decimal      @default(0)
  currencyCode CurrencyCode

  ticketsPurchased TicketPurchased[]
  WalletTickets    WalletTicket[]

  userId Int
  user   User @relation(fields: [userId], references: [id])

  @@map("wallets")
}
